{% extends "layout.html" %}
{% block content %}
<div class="container">
<div id="crime_training_input" style="display:none">
["Reported crime in 'Alabama',\n,\n2004,+4029.3\n2005,+3900\n2006,+3937\n2007,+3974.9\n2008,+4081.9",
"Reported crime in 'Alaska',\n,\n2004,+3370.9\n2005,+3615\n2006,+3582\n2007,+3373.9\n2008,+2928.3"
]
</div>
<div id="crime_training_output" style="display:none">
[
["'Alabama'","+4029.3","+3900","+3937","+3974.9","+4081.9"],
["'Alaska'","+3370.9","+3615","+3582","+3373.9","+2928.3"]
]
</div>
<div id="crime_test" style="display:none">
Reported crime in 'Alabama',
,
2004,+4029.3
2005,+3900
2006,+3937
2007,+3974.9
2008,+4081.9
==========
Reported crime in 'Alaska',
,
2004,+3370.9
2005,+3615
2006,+3582
2007,+3373.9
2008,+2928.3
==========
Reported crime in 'Arizona',
,
2004,+5073.3
2005,+4827
2006,+4741.6
2007,+4502.6
2008,+4087.3
==========
Reported crime in 'Arkansas',
,
2004,+4033.1
2005,+4068
2006,+4021.6
2007,+3945.5
2008,+3843.7
==========
Reported crime in 'California',
,
2004,+3423.9
2005,+3321
2006,+3175.2
2007,+3032.6
2008,+2940.3
==========
Reported crime in 'Colorado',
,
2004,+3918.5
2005,+4041
2006,+3441.8
2007,+2991.3
2008,+2856.7
==========
Reported crime in 'Connecticut',
,
2004,+2684.9
2005,+2579
2006,+2575
2007,+2470.6
2008,+2490.8
==========
Reported crime in 'Delaware',
,
2004,+3283.6
2005,+3118
2006,+3474.5
2007,+3427.1
2008,+3594.7
==========
Reported crime in 'District of Columbia',
,
2004,+4852.8
2005,+4490
2006,+4653.9
2007,+4916.3
2008,+5104.6
==========
Reported crime in 'Florida',
,
2004,+4182.5
2005,+4013
2006,+3986.2
2007,+4088.8
2008,+4140.6
==========
Reported crime in 'Georgia',
,
2004,+4223.5
2005,+4145
2006,+3928.8
2007,+3893.1
2008,+3996.6
==========
Reported crime in 'Hawaii',
,
2004,+4795.5
2005,+4800
2006,+4219.9
2007,+4119.3
2008,+3566.5
==========
Reported crime in 'Idaho',
,
2004,+2781
2005,+2697
2006,+2386.9
2007,+2264.2
2008,+2116.5
==========
Reported crime in 'Illinois',
,
2004,+3174.1
2005,+3092
2006,+3019.6
2007,+2935.8
2008,+2932.6
==========
Reported crime in 'Indiana',
,
2004,+3403.6
2005,+3460
2006,+3464.3
2007,+3386.5
2008,+3339.6
==========
Reported crime in 'Iowa',
,
2004,+2904.8
2005,+2845
2006,+2870.3
2007,+2648.6
2008,+2440.5
==========
Reported crime in 'Kansas',
,
2004,+4015.5
2005,+3806
2006,+3858.5
2007,+3693.8
2008,+3397
==========
Reported crime in 'Kentucky',
,
2004,+2540.2
2005,+2531
2006,+2621.9
2007,+2524.6
2008,+2677.1
==========
Reported crime in 'Louisiana',
,
2004,+4419.1
2005,+3696
2006,+4088.5
2007,+4196.1
2008,+3880.2
==========
Reported crime in 'Maine',
,
2004,+2413.7
2005,+2419
2006,+2546.1
2007,+2448.3
2008,+2463.7
==========
Reported crime in 'Maryland',
,
2004,+3640.7
2005,+3551
2006,+3481.2
2007,+3431.5
2008,+3516
==========
Reported crime in 'Massachusetts',
,
2004,+2468.2
2005,+2358
2006,+2396
2007,+2399.2
2008,+2402
==========
Reported crime in 'Michigan',
,
2004,+3066.1
2005,+3098
2006,+3226
2007,+3057.8
2008,+2945.7
==========
Reported crime in 'Minnesota',
,
2004,+3041.6
2005,+3088
2006,+3088.8
2007,+3045
2008,+2858.1
==========
Reported crime in 'Mississippi',
,
2004,+3481.1
2005,+3274
2006,+3213
2007,+3137.8
2008,+2941.7
==========
Reported crime in 'Missouri',
,
2004,+3900.1
2005,+3929
2006,+3828.4
2007,+3828.2
2008,+3663.6
==========
Reported crime in 'Montana',
,
2004,+2936.1
2005,+3146
2006,+2863.4
2007,+2863.6
2008,+2720.9
==========
Reported crime in 'Nebraska',
,
2004,+3519.6
2005,+3432
2006,+3364.9
2007,+3142.8
2008,+2878.3
==========
Reported crime in 'Nevada',
,
2004,+4210
2005,+4246
2006,+4099.6
2007,+3785.1
2008,+3456.4
==========
Reported crime in 'New Hampshire',
,
2004,+2051.9
2005,+1839
2006,+2061.8
2007,+1968.6
2008,+2132.1
==========
Reported crime in 'New Jersey',
,
2004,+2433
2005,+2337
2006,+2278.4
2007,+2205.5
2008,+2293.4
==========
Reported crime in 'New Mexico',
,
2004,+4198.4
2005,+4132
2006,+3947.5
2007,+3846.7
2008,+3817.4
==========
Reported crime in 'New York',
,
2004,+2192.5
2005,+2102
2006,+2063.2
2007,+1992.1
2008,+1993.7
==========
Reported crime in 'North Carolina',
,
2004,+4160.5
2005,+4080
2006,+4119.5
2007,+4101.8
2008,+4041.1
==========
Reported crime in 'North Dakota',
,
2004,+1963.4
2005,+2025
2006,+2088.6
2007,+1996.8
2008,+2016.3
==========
Reported crime in 'Ohio',
,
2004,+3662.3
2005,+3668
2006,+3716.2
2007,+3461.6
2008,+3419.2
==========
Reported crime in 'Oklahoma',
,
2004,+4242.1
2005,+4047
2006,+3625
2007,+3549.8
2008,+3456.6
==========
Reported crime in 'Oregon',
,
2004,+4635.4
2005,+4402
2006,+3719.1
2007,+3530.1
2008,+3299.2
==========
Reported crime in 'Pennsylvania',
,
2004,+2417.3
2005,+2422
2006,+2451
2007,+2364.4
2008,+2412.4
==========
Reported crime in 'Rhode Island',
,
2004,+2886
2005,+2728
2006,+2614.6
2007,+2602.2
2008,+2845
==========
Reported crime in 'South Carolina',
,
2004,+4536.9
2005,+4370
2006,+4277.1
2007,+4282.6
2008,+4241.2
==========
Reported crime in 'South Dakota',
,
2004,+1931.6
2005,+1767
2006,+1811.1
2007,+1774
2008,+1706.1
==========
Reported crime in 'Tennessee',
,
2004,+4326.8
2005,+4300
2006,+4137.7
2007,+4092.2
2008,+4048.3
==========
Reported crime in 'Texas',
,
2004,+4497.7
2005,+4319
2006,+4084.2
2007,+4121.6
2008,+3987
==========
Reported crime in 'Utah',
,
2004,+4038.6
2005,+3837
2006,+3505.3
2007,+3510.1
2008,+3374
==========
Reported crime in 'Vermont',
,
2004,+2343.6
2005,+2370
2006,+2368
2007,+2339
2008,+2559.8
==========
Reported crime in 'Virginia',
,
2004,+2678.2
2005,+2649
2006,+2479.6
2007,+2480
2008,+2531.8
==========
Reported crime in 'Washington',
,
2004,+4846.7
2005,+4890
2006,+4483.3
2007,+4026
2008,+3785
==========
Reported crime in 'West Virginia',
,
2004,+2555.8
2005,+2633
2006,+2639.9
2007,+2543.6
2008,+2554.4
==========
Reported crime in 'Wisconsin',
,
2004,+2665.7
2005,+2669
2006,+2820
2007,+2842.8
2008,+2761.1
==========
Reported crime in 'Wyoming',
,
2004,+3338.5
2005,+3158
2006,+2989.1
2007,+2883.2
2008,+2724.2

</div>
<div id="hadoop_training_input" style="display:none">
["2012-01-04 00:01:23,180 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_-2281137920769708011_1116 src: /127.0.0.1:32981 dest: /127.0.0.1:50010",
"2012-01-04 00:01:23,185 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_-2281137920769708011_1116 terminating"]
</div>
<div id="hadoop_training_output" style="display:none">
[
["2012-01-04", "00:01:23", "127.0.0.1:32981", "127.0.0.1:50010"],
["2012-01-04", "00:01:23", "", ""]
]
</div>
<div id="hadoop_test" style="display:none">
2012-01-04 00:01:23,180 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_-2281137920769708011_1116 src: /127.0.0.1:32981 dest: /127.0.0.1:50010
2012-01-04 00:01:23,184 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32981, dest: /127.0.0.1:50010, bytes: 3758, op: HDFS_WRITE, cliID: DFSClient_-603743753, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-2281137920769708011_1116, duration: 2016056
2012-01-04 00:01:23,185 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_-2281137920769708011_1116 terminating
2012-01-04 00:01:23,291 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_3766031435252346505_1117 src: /127.0.0.1:32982 dest: /127.0.0.1:50010
2012-01-04 00:01:23,293 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32982, dest: /127.0.0.1:50010, bytes: 265, op: HDFS_WRITE, cliID: DFSClient_-603743753, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_3766031435252346505_1117, duration: 552828
2012-01-04 00:01:23,293 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_3766031435252346505_1117 terminating
2012-01-04 00:01:23,324 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_-8044922265890142318_1118 src: /127.0.0.1:32983 dest: /127.0.0.1:50010
2012-01-04 00:01:23,326 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32983, dest: /127.0.0.1:50010, bytes: 43, op: HDFS_WRITE, cliID: DFSClient_-603743753, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-8044922265890142318_1118, duration: 607104
2012-01-04 00:01:23,327 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_-8044922265890142318_1118 terminating
2012-01-04 00:01:23,409 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_-965793757262168743_1119 src: /127.0.0.1:32984 dest: /127.0.0.1:50010
2012-01-04 00:01:23,411 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32984, dest: /127.0.0.1:50010, bytes: 29743, op: HDFS_WRITE, cliID: DFSClient_-603743753, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-965793757262168743_1119, duration: 751930
2012-01-04 00:01:23,411 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_-965793757262168743_1119 terminating
2012-01-04 00:01:23,433 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:32986, bytes: 29979, op: HDFS_READ, cliID: DFSClient_-2054881890, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-965793757262168743_1119, duration: 426255
2012-01-04 00:01:23,494 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_5415910957659089697_1121 src: /127.0.0.1:32987 dest: /127.0.0.1:50010
2012-01-04 00:01:23,498 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32987, dest: /127.0.0.1:50010, bytes: 39683, op: HDFS_WRITE, cliID: DFSClient_-2054881890, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_5415910957659089697_1121, duration: 1103916
2012-01-04 00:01:23,498 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_5415910957659089697_1121 terminating
2012-01-04 00:01:23,523 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Receiving block blk_-5517241460358700441_1122 src: /127.0.0.1:32989 dest: /127.0.0.1:50010
2012-01-04 00:01:23,526 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:32989, dest: /127.0.0.1:50010, bytes: 106, op: HDFS_WRITE, cliID: DFSClient_-1591337821, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-5517241460358700441_1122, duration: 1055149
2012-01-04 00:01:23,527 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: PacketResponder 0 for block blk_-5517241460358700441_1122 terminating
2012-01-04 00:01:23,536 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:32990, bytes: 47, op: HDFS_READ, cliID: DFSClient_-2054881890, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-8044922265890142318_1118, duration: 369801
2012-01-04 00:01:23,776 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:32992, bytes: 110, op: HDFS_READ, cliID: DFSClient_1232222388, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-5517241460358700441_1122, duration: 377331
2012-01-04 00:01:23,790 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:32994, bytes: 29979, op: HDFS_READ, cliID: DFSClient_314976880, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-965793757262168743_1119, duration: 527687
2012-01-04 00:01:23,837 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:32995, bytes: 3790, op: HDFS_READ, cliID: DFSClient_314976880, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-2281137920769708011_1116, duration: 409561
2012-01-04 00:01:24,862 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Scheduling block blk_-2289356614634084790_1114 file /hadoop/dfs/data/current/blk_-2289356614634084790 for deletion
2012-01-04 00:01:24,862 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Scheduling block blk_6186891375771801408_1115 file /hadoop/dfs/data/current/blk_6186891375771801408 for deletion
2012-01-04 00:01:24,863 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Deleted block blk_-2289356614634084790_1114 at file /hadoop/dfs/data/current/blk_-2289356614634084790
2012-01-04 00:01:24,863 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: Deleted block blk_6186891375771801408_1115 at file /hadoop/dfs/data/current/blk_6186891375771801408
2012-01-04 00:01:26,285 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33005, bytes: 269, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000001_0, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_3766031435252346505_1117, duration: 354302
2012-01-04 00:01:26,396 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33007, bytes: 269, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000000_0, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_3766031435252346505_1117, duration: 271263
2012-01-04 00:01:26,458 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33008, bytes: 23599, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000000_0, offset: 23040, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-8059590744032704567_1083, duration: 541274
2012-01-04 00:01:26,534 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33009, bytes: 46819, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000001_0, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-8059590744032704567_1083, duration: 441263
2012-01-04 00:01:31,109 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33016, bytes: 269, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000000_1, offset: 0, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_3766031435252346505_1117, duration: 350366
2012-01-04 00:01:31,190 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /127.0.0.1:50010, dest: /127.0.0.1:33017, bytes: 23599, op: HDFS_READ, cliID: DFSClient_attempt_201201032134_0020_m_000000_1, offset: 23040, srvID: DS-292194659-127.0.1.1-50010-1324763300176, blockid: blk_-8059590744032704567_1083, duration: 472418
</div>

<div id="content">
  <h3 class="inline-block">
    <a class="link" href=/browse/{{repo_base}}>{{repo_base}}</a>
    <a class="link" href=/browse/{{repo_base}}>/</a>
    <a class="link" href=/browse/{{repo_base}}/{{repo}}>{{repo}}</a>
    <a class="link" href=/browse/{{repo_base}}/{{repo}}>/</a>
  </h3>
  
  <div class="pull-right">
    <a class="btn btn-primary btn-sm" type="button" href="/console">Create Table with SQL</a>
    <a class="btn btn-primary btn-sm" type="button" href="/browse/{{repo_base}}/{{repo}}#files">Upload Files</a> 
  </div>
  <hr />
  <h3>Paste data below (or, select an example data)</h3>
  <div style="padding-top:1em; padding-bottom:1em;">
    <h4> Example Data: </h4>
    <select id="select_example">
    <option value="hadoop">Hadoop Log</option>
    <option value="crime">Crime</option>
    </select>
  </div>
  <div id="error"></div>
  <table cellspacing="0" style="width:100%">
    <tr>
      <td style="width:50%">
        <h4>Example Input</h4>
      </td>
      <td style="width:50%">
        <h4>Example Output</h4>
      </td>
    </tr>
    <tr>
      <td>
        <textarea id="training_input" style="width:100%; height:200px;"></textarea>
      </td>
      <td>
        <textarea id="training_output" style="width:100%; height:200px;"></textarea>
      </td>
    </tr>
  </table>
  <table cellspacing="0" style="width:100%">
  <tr><td style="width:100%"><h4>Data</h4></td></tr>
  <tr>
  <td style="width:100%">
  <textarea id="test_data" style="width:100%; height:600px;" ></textarea>
  </td>
  </tr>
  </table>
  <br />
  <br />
  <button class="btn btn-primary" type="button" id="btn-refine-data" style="margin-left:0px;">Refine</button>
  <br />
  <br />
  <div id="results_container">
  <table cellspacing="0" style="width:100%">
  <tr><td style="width:100%"><h4>Results</h4></td></tr>
  <tr>
  <td style="width:100%">
  <textarea id="results_data" style="width:100%; height:600px;" ></textarea>
  </td>
  </tr>
  </table>
  <br />
  <br />
  <h4>Save resuts as DataHub Table</h4>
  <div id="error_results"></div>
  <h5> Table Name </h4></td>
  <input type="text" id="table_name" placeholder="Table Name"><br /><br />
  <button class="btn btn-primary" type="button" id="btn-create-table" style="margin-left:0px;">Create Table</button>
  </div>
  <br />
  <br />
</div>
</div>
  
<script type="text/javascript">

$(document).ready(function($) { 
  $("#results_container").hide()
  var selected = $('#select_example').find(":selected").val()
  var record_separator = '\n'

  $("#training_input").val($('#' + selected + '_training_input').text())
  $("#training_output").val($('#' + selected + '_training_output').text())
  $("#test_data").val($('#' + selected + '_test').text())
  if (selected == 'crime') {
    record_separator = '==========\n'
  } else {
    record_separator = '\n'
  }

  $("#select_example").change(function () {
    selected = $('#select_example').find(":selected").val();
    $("#training_input").val($('#' + selected + '_training_input').text())
    $("#training_output").val($('#' + selected + '_training_output').text())
    $("#test_data").val($('#' + selected + '_test').text())
    if (selected == 'crime') {
      record_separator = '==========\n'
    } else {
      record_separator = '\n'
    }
  })

  


  var refine_data = function(){
    $.ajax({
      type:'POST',
      url:'/apps/refiner/refine-data',
      async: false, 
      cache: false,
      data:{
        'training_input': $("#training_input").val(),
        'training_output': $("#training_output").val(),
        'test_data': $("#test_data").val(),
        'record_separator': record_separator
      }, 
      success: function(res) {
        $("#results_container").show()
        $("#results_data").val(res.output)        
      }
    });
  }

  
  $("#btn-refine-data").click(refine_data);
  //$("#btn-create-table").click(create_table);
});


</script>
{% endblock %}


